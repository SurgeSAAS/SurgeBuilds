<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Surge Business Solutions</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root {
    --bg: #07070F;
    --surface: #0D0D1A;
    --surface2: #121220;
    --border: #1E1E38;
    --accent: #7C3AED;
    --accent-bright: #A855F7;
    --accent2: #2563EB;
    --accent2-bright: #60A5FA;
    --text: #E8EDF2;
    --muted: #4A4A6A;
    --danger: #FF4455;
    --warning: #FFB800;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Syne',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; overflow-x:hidden; }
  body::before { content:''; position:fixed; inset:0; background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E"); pointer-events:none; z-index:0; }

  /* LOGIN */
  #login-screen { min-height:100vh; display:flex; align-items:center; justify-content:center; position:relative; }
  .login-glow { position:absolute; width:700px; height:700px; background:radial-gradient(circle, rgba(124,58,237,0.08) 0%, transparent 70%); pointer-events:none; }
  .login-box { background:var(--surface); border:1px solid var(--border); padding:48px; width:440px; position:relative; z-index:1; border-radius:4px; }
  .login-box::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:linear-gradient(90deg,var(--accent),var(--accent2)); border-radius:4px 4px 0 0; }
  .login-logo { font-size:10px; font-family:'DM Mono',monospace; color:var(--accent-bright); letter-spacing:0.3em; text-transform:uppercase; margin-bottom:6px; }
  .login-title { font-size:28px; font-weight:800; margin-bottom:4px; letter-spacing:-0.02em; background:linear-gradient(135deg,#fff 0%,var(--accent-bright) 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
  .login-sub { font-size:12px; color:var(--muted); font-family:'DM Mono',monospace; margin-bottom:36px; }
  .form-group { margin-bottom:20px; }
  .form-label { display:block; font-size:10px; font-family:'DM Mono',monospace; color:var(--muted); letter-spacing:0.15em; text-transform:uppercase; margin-bottom:8px; }
  .form-input { width:100%; background:var(--bg); border:1px solid var(--border); color:var(--text); padding:12px 16px; font-family:'DM Mono',monospace; font-size:14px; outline:none; transition:border-color 0.2s; border-radius:2px; }
  .form-input:focus { border-color:var(--accent); }
  .form-input::placeholder { color:var(--muted); }
  .btn-primary { width:100%; background:linear-gradient(135deg,var(--accent),var(--accent2)); color:white; border:none; padding:14px; font-family:'Syne',sans-serif; font-size:13px; font-weight:700; letter-spacing:0.1em; text-transform:uppercase; cursor:pointer; transition:opacity 0.2s; margin-top:8px; border-radius:2px; }
  .btn-primary:hover { opacity:0.85; }
  .btn-primary:disabled { opacity:0.4; cursor:not-allowed; }
  .error-msg { background:rgba(255,68,85,0.1); border:1px solid rgba(255,68,85,0.3); color:var(--danger); padding:10px 14px; font-size:12px; font-family:'DM Mono',monospace; margin-top:16px; display:none; border-radius:2px; }

  /* APP */
  #app { display:none; min-height:100vh; }

  /* SIDEBAR */
  .sidebar { position:fixed; left:0; top:0; bottom:0; width:224px; background:var(--surface); border-right:1px solid var(--border); display:flex; flex-direction:column; z-index:100; }
  .sidebar-logo { padding:24px 20px; border-bottom:1px solid var(--border); }
  .sidebar-logo-tag { font-size:9px; font-family:'DM Mono',monospace; color:var(--accent-bright); letter-spacing:0.3em; text-transform:uppercase; }
  .sidebar-logo-name { font-size:15px; font-weight:800; letter-spacing:-0.01em; margin-top:3px; background:linear-gradient(135deg,#fff 0%,var(--accent-bright) 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; line-height:1.3; }
  .sidebar-nav { padding:16px 0; flex:1; }
  .nav-section-label { font-size:9px; font-family:'DM Mono',monospace; color:var(--muted); letter-spacing:0.25em; text-transform:uppercase; padding:8px 20px; margin-top:8px; }
  .nav-item { display:flex; align-items:center; gap:10px; padding:10px 20px; font-size:13px; font-weight:600; color:var(--muted); cursor:pointer; transition:all 0.15s; border-left:2px solid transparent; letter-spacing:0.02em; }
  .nav-item:hover { color:var(--text); background:rgba(124,58,237,0.05); }
  .nav-item.active { color:var(--accent-bright); border-left-color:var(--accent); background:rgba(124,58,237,0.08); }
  .nav-icon { width:15px; height:15px; opacity:0.7; flex-shrink:0; }
  .nav-item.active .nav-icon { opacity:1; }
  .sidebar-footer { padding:16px 20px; border-top:1px solid var(--border); }
  .admin-badge { display:flex; align-items:center; gap:10px; }
  .admin-avatar { width:30px; height:30px; background:linear-gradient(135deg,var(--accent),var(--accent2)); display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:800; color:white; flex-shrink:0; border-radius:2px; }
  .admin-info { flex:1; min-width:0; }
  .admin-name { font-size:12px; font-weight:700; }
  .admin-role { font-size:9px; font-family:'DM Mono',monospace; color:var(--accent-bright); letter-spacing:0.15em; }
  .logout-btn { background:none; border:none; color:var(--muted); cursor:pointer; font-size:12px; padding:2px; transition:color 0.15s; }
  .logout-btn:hover { color:var(--danger); }

  /* MAIN */
  .main { margin-left:224px; min-height:100vh; position:relative; z-index:1; }
  .topbar { padding:20px 32px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; background:var(--surface); position:sticky; top:0; z-index:50; }
  .page-title { font-size:18px; font-weight:800; letter-spacing:-0.02em; }
  .page-sub { font-size:11px; font-family:'DM Mono',monospace; color:var(--muted); margin-top:2px; }
  .topbar-actions { display:flex; gap:12px; align-items:center; }
  .btn-accent { background:linear-gradient(135deg,var(--accent),var(--accent2)); color:white; border:none; padding:9px 18px; font-family:'Syne',sans-serif; font-size:12px; font-weight:700; letter-spacing:0.08em; text-transform:uppercase; cursor:pointer; transition:opacity 0.2s; display:flex; align-items:center; gap:6px; border-radius:2px; }
  .btn-accent:hover { opacity:0.85; }
  .btn-ghost { background:transparent; color:var(--muted); border:1px solid var(--border); padding:9px 18px; font-family:'Syne',sans-serif; font-size:12px; font-weight:600; cursor:pointer; transition:all 0.15s; border-radius:2px; }
  .btn-ghost:hover { color:var(--text); border-color:var(--muted); }
  .content { padding:32px; }

  /* STATS */
  .stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:32px; }
  .stat-card { background:var(--surface); border:1px solid var(--border); padding:20px 24px; position:relative; overflow:hidden; border-radius:2px; }
  .stat-card::after { content:''; position:absolute; bottom:0; left:0; right:0; height:1px; background:linear-gradient(90deg,var(--accent),var(--accent2),transparent); opacity:0.4; }
  .stat-label { font-size:10px; font-family:'DM Mono',monospace; color:var(--muted); letter-spacing:0.2em; text-transform:uppercase; margin-bottom:8px; }
  .stat-value { font-size:36px; font-weight:800; letter-spacing:-0.03em; line-height:1; }
  .stat-value.accent { color:var(--accent-bright); }
  .stat-value.blue { color:var(--accent2-bright); }
  .stat-value.warning { color:var(--warning); }
  .stat-change { font-size:11px; font-family:'DM Mono',monospace; color:var(--muted); margin-top:6px; }

  /* TABLE */
  .section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
  .section-title { font-size:14px; font-weight:700; letter-spacing:0.02em; }
  .search-input { background:var(--surface); border:1px solid var(--border); color:var(--text); padding:8px 14px; font-family:'DM Mono',monospace; font-size:12px; outline:none; width:220px; transition:border-color 0.2s; border-radius:2px; }
  .search-input:focus { border-color:var(--accent); }
  .search-input::placeholder { color:var(--muted); }
  .clients-table { background:var(--surface); border:1px solid var(--border); overflow:hidden; border-radius:2px; }
  .table-header { display:grid; grid-template-columns:2fr 1.2fr 1fr 1fr 1fr 120px; padding:12px 20px; background:var(--surface2); border-bottom:1px solid var(--border); }
  .th { font-size:9px; font-family:'DM Mono',monospace; color:var(--muted); letter-spacing:0.2em; text-transform:uppercase; }
  .table-row { display:grid; grid-template-columns:2fr 1.2fr 1fr 1fr 1fr 120px; padding:14px 20px; border-bottom:1px solid var(--border); align-items:center; transition:background 0.15s; cursor:pointer; }
  .table-row:last-child { border-bottom:none; }
  .table-row:hover { background:rgba(124,58,237,0.04); }
  .client-name-cell { display:flex; align-items:center; gap:12px; }
  .client-avatar { width:32px; height:32px; background:linear-gradient(135deg,var(--accent),var(--accent2)); display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; color:white; flex-shrink:0; font-family:'DM Mono',monospace; border-radius:2px; }
  .client-name { font-size:13px; font-weight:700; }
  .client-slug { font-size:10px; font-family:'DM Mono',monospace; color:var(--muted); margin-top:2px; }
  .td { font-size:12px; color:var(--muted); font-family:'DM Mono',monospace; }
  .badge { display:inline-flex; align-items:center; gap:5px; padding:3px 9px; font-size:9px; font-family:'DM Mono',monospace; letter-spacing:0.15em; text-transform:uppercase; font-weight:500; border-radius:2px; }
  .badge-active { background:rgba(124,58,237,0.15); color:var(--accent-bright); border:1px solid rgba(124,58,237,0.3); }
  .badge-inactive { background:rgba(255,68,85,0.1); color:var(--danger); border:1px solid rgba(255,68,85,0.2); }
  .badge-texts { background:rgba(37,99,235,0.15); color:var(--accent2-bright); border:1px solid rgba(37,99,235,0.3); }
  .badge-base { background:rgba(255,255,255,0.05); color:var(--muted); border:1px solid var(--border); }
  .row-actions { display:flex; gap:6px; justify-content:flex-end; align-items:center; }
  .icon-btn { background:none; border:1px solid var(--border); color:var(--muted); width:28px; height:28px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all 0.15s; font-size:11px; border-radius:2px; text-decoration:none; }
  .icon-btn:hover { color:var(--accent-bright); border-color:var(--accent); }
  .icon-btn.danger:hover { color:var(--danger); border-color:var(--danger); }
  .icon-btn.link-btn { color:var(--accent2-bright); border-color:rgba(37,99,235,0.3); }
  .icon-btn.link-btn:hover { color:white; border-color:var(--accent2-bright); background:rgba(37,99,235,0.15); }

  /* EMPTY */
  .empty-state { text-align:center; padding:60px 20px; color:var(--muted); }
  .empty-icon { font-size:40px; margin-bottom:16px; opacity:0.3; }
  .empty-title { font-size:16px; font-weight:700; color:var(--text); margin-bottom:8px; }
  .empty-sub { font-size:12px; font-family:'DM Mono',monospace; }

  /* MODAL */
  .modal-overlay { position:fixed; inset:0; background:rgba(7,7,15,0.85); display:none; align-items:center; justify-content:center; z-index:1000; backdrop-filter:blur(4px); }
  .modal-overlay.open { display:flex; }
  .modal { background:var(--surface); border:1px solid var(--border); width:540px; max-height:90vh; overflow-y:auto; position:relative; border-radius:4px; }
  .modal::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:linear-gradient(90deg,var(--accent),var(--accent2)); border-radius:4px 4px 0 0; }
  .modal-header { padding:24px 28px 20px; border-bottom:1px solid var(--border); display:flex; align-items:flex-start; justify-content:space-between; }
  .modal-title { font-size:18px; font-weight:800; letter-spacing:-0.02em; }
  .modal-sub { font-size:11px; font-family:'DM Mono',monospace; color:var(--muted); margin-top:3px; }
  .modal-close { background:none; border:none; color:var(--muted); cursor:pointer; font-size:18px; line-height:1; padding:2px; }
  .modal-close:hover { color:var(--text); }
  .modal-body { padding:24px 28px; }
  .modal-footer { padding:16px 28px; border-top:1px solid var(--border); display:flex; gap:12px; justify-content:flex-end; }
  .form-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .toggle-row { display:flex; align-items:center; justify-content:space-between; padding:12px 0; border-bottom:1px solid var(--border); }
  .toggle-row:last-child { border-bottom:none; }
  .toggle-label { font-size:13px; font-weight:600; }
  .toggle-desc { font-size:11px; font-family:'DM Mono',monospace; color:var(--muted); margin-top:2px; }
  .toggle { position:relative; width:36px; height:20px; background:var(--border); border-radius:10px; cursor:pointer; transition:background 0.2s; flex-shrink:0; }
  .toggle.on { background:var(--accent); }
  .toggle::after { content:''; position:absolute; width:14px; height:14px; background:white; border-radius:50%; top:3px; left:3px; transition:transform 0.2s; }
  .toggle.on::after { transform:translateX(16px); }

  /* DETAIL */
  #client-detail { display:none; }
  .back-btn { display:flex; align-items:center; gap:8px; font-size:12px; font-family:'DM Mono',monospace; color:var(--muted); cursor:pointer; margin-bottom:24px; width:fit-content; transition:color 0.15s; }
  .back-btn:hover { color:var(--accent-bright); }
  .client-detail-header { display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:28px; padding-bottom:24px; border-bottom:1px solid var(--border); }
  .client-detail-avatar { width:48px; height:48px; background:linear-gradient(135deg,var(--accent),var(--accent2)); display:flex; align-items:center; justify-content:center; font-size:18px; font-weight:800; color:white; font-family:'DM Mono',monospace; margin-right:16px; border-radius:4px; }
  .detail-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:24px; }
  .detail-card { background:var(--surface); border:1px solid var(--border); padding:20px; border-radius:2px; }
  .detail-card-label { font-size:9px; font-family:'DM Mono',monospace; color:var(--muted); letter-spacing:0.2em; text-transform:uppercase; margin-bottom:8px; }
  .detail-card-value { font-size:22px; font-weight:800; }
  .permissions-section { background:var(--surface); border:1px solid var(--border); padding:20px 24px; margin-bottom:16px; border-radius:2px; }
  .permissions-title { font-size:12px; font-weight:700; letter-spacing:0.05em; margin-bottom:4px; }
  .permissions-sub { font-size:10px; font-family:'DM Mono',monospace; color:var(--muted); margin-bottom:16px; }
  .url-display { background:var(--bg); border:1px solid var(--border); padding:10px 14px; font-family:'DM Mono',monospace; font-size:11px; color:var(--accent-bright); display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; border-radius:2px; }
  .copy-btn { background:none; border:none; color:var(--muted); cursor:pointer; font-size:11px; transition:color 0.15s; }
  .copy-btn:hover { color:var(--accent-bright); }

  .loading { display:flex; align-items:center; justify-content:center; padding:40px; font-family:'DM Mono',monospace; font-size:12px; color:var(--muted); gap:10px; }
  .spinner { width:16px; height:16px; border:2px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin 0.7s linear infinite; }
  @keyframes spin { to { transform:rotate(360deg); } }

  .toast { position:fixed; bottom:24px; right:24px; background:var(--surface); border:1px solid var(--border); border-left:3px solid var(--accent); padding:12px 18px; font-size:12px; font-family:'DM Mono',monospace; z-index:9999; transform:translateY(100px); opacity:0; transition:all 0.3s; border-radius:2px; }
  .toast.show { transform:translateY(0); opacity:1; }
  .toast.error { border-left-color:var(--danger); }

  textarea.form-input { resize:vertical; min-height:80px; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-glow"></div>
  <div class="login-box">
    <div class="login-logo">Surge Business Solutions</div>
    <div class="login-title">Admin Portal</div>
    <div class="login-sub">// restricted access only</div>
    <div class="form-group">
      <label class="form-label">Email</label>
      <input type="email" class="form-input" id="login-email" placeholder="admin@surgebuilds.co">
    </div>
    <div class="form-group">
      <label class="form-label">Password</label>
      <input type="password" class="form-input" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    </div>
    <button class="btn-primary" id="login-btn" onclick="handleLogin()">Access Dashboard</button>
    <div class="error-msg" id="login-error"></div>
  </div>
</div>

<!-- APP -->
<div id="app">
  <div class="sidebar">
    <div class="sidebar-logo">
      <div class="sidebar-logo-tag">Admin Portal</div>
      <div class="sidebar-logo-name">Surge Business Solutions</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section-label">Main</div>
      <div class="nav-item active" onclick="showView('overview',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M1 1h6v6H1zm8 0h6v6H9zM1 9h6v6H1zm8 0h6v6H9z"/></svg>
        Overview
      </div>
      <div class="nav-item" onclick="showView('clients',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M8 8a3 3 0 100-6 3 3 0 000 6zm-5 6a5 5 0 0110 0H3z"/></svg>
        Clients
      </div>
      <div class="nav-section-label">Tools</div>
      <div class="nav-item" onclick="showView('texts',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M14 1H2a1 1 0 00-1 1v8a1 1 0 001 1h3v3l4-3h5a1 1 0 001-1V2a1 1 0 00-1-1z"/></svg>
        Text Campaigns
      </div>
      <div class="nav-item" onclick="showView('billing',this)">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M1 4h14v2H1zm0 4h14v5H1z"/></svg>
        Billing
      </div>
    </nav>
    <div class="sidebar-footer">
      <div class="admin-badge">
        <div class="admin-avatar" id="admin-avatar-initial">S</div>
        <div class="admin-info">
          <div class="admin-name">Surge Admin</div>
          <div class="admin-role">‚óè ONLINE</div>
        </div>
        <button class="logout-btn" onclick="handleLogout()">‚úï</button>
      </div>
    </div>
  </div>

  <div class="main">
    <!-- OVERVIEW -->
    <div id="view-overview">
      <div class="topbar">
        <div>
          <div class="page-title">Overview</div>
          <div class="page-sub">// Surge Business Solutions ¬∑ command center</div>
        </div>
        <div class="topbar-actions">
          <button class="btn-accent" onclick="openAddClient()">+ Add Client</button>
        </div>
      </div>
      <div class="content">
        <div class="stats-row">
          <div class="stat-card"><div class="stat-label">Total Clients</div><div class="stat-value accent" id="stat-total">0</div><div class="stat-change">registered businesses</div></div>
          <div class="stat-card"><div class="stat-label">Active</div><div class="stat-value" id="stat-active">0</div><div class="stat-change">currently live</div></div>
          <div class="stat-card"><div class="stat-label">Text Add-on</div><div class="stat-value blue" id="stat-texts">0</div><div class="stat-change">recurring campaigns</div></div>
          <div class="stat-card"><div class="stat-label">MRR</div><div class="stat-value warning" id="stat-mrr">$0</div><div class="stat-change">monthly recurring</div></div>
        </div>
        <div class="section-header">
          <div class="section-title">Recent Clients</div>
          <button class="btn-ghost" onclick="showView('clients',null)">View All ‚Üí</button>
        </div>
        <div class="clients-table">
          <div class="table-header">
            <div class="th">Business</div><div class="th">Type</div><div class="th">Plan</div><div class="th">Status</div><div class="th">Added</div><div class="th"></div>
          </div>
          <div id="overview-clients-list"><div class="loading"><div class="spinner"></div> Loading...</div></div>
        </div>
      </div>
    </div>

    <!-- CLIENTS -->
    <div id="view-clients" style="display:none">
      <div id="clients-list-view">
        <div class="topbar">
          <div><div class="page-title">Clients</div><div class="page-sub">// all registered businesses</div></div>
          <div class="topbar-actions">
            <input type="text" class="search-input" placeholder="Search clients..." oninput="filterClients(this.value)">
            <button class="btn-accent" onclick="openAddClient()">+ Add Client</button>
          </div>
        </div>
        <div class="content">
          <div class="clients-table">
            <div class="table-header">
              <div class="th">Business</div><div class="th">Type</div><div class="th">Plan</div><div class="th">Status</div><div class="th">Added</div><div class="th">Actions</div>
            </div>
            <div id="all-clients-list"><div class="loading"><div class="spinner"></div> Loading...</div></div>
          </div>
        </div>
      </div>

      <!-- DETAIL -->
      <div id="client-detail">
        <div class="topbar">
          <div><div class="page-title" id="detail-page-title">Client Detail</div><div class="page-sub" id="detail-page-sub">// client management</div></div>
          <div class="topbar-actions">
            <button class="btn-ghost" onclick="openEditClient()">Edit Client</button>
            <button class="btn-accent" id="detail-visit-btn">Visit Site ‚Üó</button>
          </div>
        </div>
        <div class="content">
          <div class="back-btn" onclick="showClientsList()">‚Üê Back to Clients</div>
          <div class="client-detail-header">
            <div style="display:flex;align-items:center">
              <div class="client-detail-avatar" id="detail-avatar">?</div>
              <div>
                <div style="font-size:24px;font-weight:800;letter-spacing:-0.02em" id="detail-name">‚Äî</div>
                <div style="font-size:11px;font-family:'DM Mono',monospace;color:var(--muted);margin-top:3px" id="detail-slug">‚Äî</div>
              </div>
            </div>
            <div id="detail-status-badge"></div>
          </div>
          <div class="detail-grid">
            <div class="detail-card"><div class="detail-card-label">Monthly Plan</div><div class="detail-card-value" id="detail-price">$0</div></div>
            <div class="detail-card"><div class="detail-card-label">Business Type</div><div class="detail-card-value" style="font-size:16px" id="detail-type">‚Äî</div></div>
          </div>
          <div class="url-display">
            <span id="detail-url">surgebuilds.co/‚Äî</span>
            <button class="copy-btn" onclick="copyUrl()">copy ‚ßâ</button>
          </div>
          <div class="permissions-section">
            <div class="permissions-title">Client Permissions</div>
            <div class="permissions-sub">// what this client can edit in their dashboard</div>
            <div id="permissions-toggles"></div>
          </div>
          <div class="permissions-section">
            <div class="permissions-title">Notes</div>
            <div class="permissions-sub">// internal notes</div>
            <div id="detail-notes" style="font-size:13px;color:var(--muted);font-family:'DM Mono',monospace;line-height:1.6">‚Äî</div>
          </div>
        </div>
      </div>
    </div>

    <!-- TEXTS -->
    <div id="view-texts" style="display:none">
      <div class="topbar"><div><div class="page-title">Text Campaigns</div><div class="page-sub">// recurring messaging add-on</div></div></div>
      <div class="content"><div class="empty-state"><div class="empty-icon">üì±</div><div class="empty-title">Text Campaigns Coming Soon</div><div class="empty-sub">Add clients with the texts add-on to manage campaigns here</div></div></div>
    </div>

    <!-- BILLING -->
    <div id="view-billing" style="display:none">
      <div class="topbar"><div><div class="page-title">Billing</div><div class="page-sub">// client subscriptions</div></div></div>
      <div class="content"><div class="empty-state"><div class="empty-icon">üí≥</div><div class="empty-title">Billing Dashboard Coming Soon</div><div class="empty-sub">Stripe integration will show all client subscriptions here</div></div></div>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="client-modal">
  <div class="modal">
    <div class="modal-header">
      <div><div class="modal-title" id="modal-title">Add New Client</div><div class="modal-sub" id="modal-sub">// register a new business</div></div>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group"><label class="form-label">Business Name</label><input type="text" class="form-input" id="client-name" placeholder="Sneakers By Luca"></div>
        <div class="form-group"><label class="form-label">URL Slug</label><input type="text" class="form-input" id="client-slug" placeholder="sneakers-by-luca"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Business Type</label><input type="text" class="form-input" id="client-type" placeholder="e.g. Sneaker Reseller, Barbershop..."></div>
        <div class="form-group"><label class="form-label">Monthly Price ($)</label><input type="number" class="form-input" id="client-price" placeholder="80"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label class="form-label">Owner Name</label><input type="text" class="form-input" id="client-owner" placeholder="Luca"></div>
        <div class="form-group"><label class="form-label">Phone Number</label><input type="text" class="form-input" id="client-phone" placeholder="+1 (555) 000-0000"></div>
      </div>
      <div class="form-group"><label class="form-label">Website URL</label><input type="text" class="form-input" id="client-website" placeholder="https://surgebuilds.co/sneakers-by-luca"></div>
      <div class="form-group"><label class="form-label">Notes (internal)</label><textarea class="form-input" id="client-notes" placeholder="Anything to remember about this client..."></textarea></div>
      <div style="margin-top:20px">
        <div style="font-size:11px;font-family:'DM Mono',monospace;color:var(--muted);letter-spacing:0.15em;text-transform:uppercase;margin-bottom:12px">Add-ons & Permissions</div>
        <div class="toggle-row"><div><div class="toggle-label">Recurring Texts Add-on</div><div class="toggle-desc">+$40-60/mo ¬∑ client gets text campaign access</div></div><div class="toggle" id="toggle-texts" onclick="toggleSwitch('texts')"></div></div>
        <div class="toggle-row"><div><div class="toggle-label">Can Edit Bio / Description</div><div class="toggle-desc">client can update their own description</div></div><div class="toggle" id="toggle-bio" onclick="toggleSwitch('bio')"></div></div>
        <div class="toggle-row"><div><div class="toggle-label">Can Edit Services & Prices</div><div class="toggle-desc">client can manage their service menu</div></div><div class="toggle" id="toggle-services" onclick="toggleSwitch('services')"></div></div>
        <div class="toggle-row"><div><div class="toggle-label">Can Edit Photos</div><div class="toggle-desc">client can upload and manage photos</div></div><div class="toggle" id="toggle-photos" onclick="toggleSwitch('photos')"></div></div>
        <div class="toggle-row"><div><div class="toggle-label">Can View Bookings / Orders</div><div class="toggle-desc">client can see incoming requests</div></div><div class="toggle on" id="toggle-bookings" onclick="toggleSwitch('bookings')"></div></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn-accent" id="save-client-btn" onclick="saveClient()">Save Client</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const { createClient } = supabase;
const sb = createClient('https://zvrypvsndhkirxockflg.supabase.co','sb_publishable_phRSB9e426qhCCHJ_WEpVg_W_Y2IYwC');

let allClients = [], currentClient = null, editingClientId = null;
let toggleStates = { texts:false, bio:false, services:false, photos:false, bookings:true };

async function handleLogin() {
  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;
  const btn = document.getElementById('login-btn');
  const err = document.getElementById('login-error');
  if (!email || !password) { showLoginError('Please enter email and password.'); return; }
  btn.disabled = true; btn.textContent = 'Authenticating...'; err.style.display = 'none';
  const { data, error } = await sb.auth.signInWithPassword({ email, password });
  if (error) { showLoginError(error.message); btn.disabled = false; btn.textContent = 'Access Dashboard'; return; }
  showApp(data.user);
}

function showLoginError(msg) { const e = document.getElementById('login-error'); e.textContent = msg; e.style.display = 'block'; }

async function handleLogout() {
  await sb.auth.signOut();
  document.getElementById('app').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
}

function showApp(user) {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  document.getElementById('admin-avatar-initial').textContent = user.email ? user.email[0].toUpperCase() : 'S';
  loadClients();
}

sb.auth.getSession().then(({ data: { session } }) => { if (session) showApp(session.user); });
document.addEventListener('keydown', e => { if (e.key === 'Enter' && document.getElementById('login-screen').style.display !== 'none') handleLogin(); });

function showView(view, el) {
  ['overview','clients','texts','billing'].forEach(v => { document.getElementById(`view-${v}`).style.display = v === view ? 'block' : 'none'; });
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if (el) el.classList.add('active');
  if (view === 'clients') showClientsList();
}

async function loadClients() {
  const { data, error } = await sb.from('clients').select('*').order('created_at', { ascending: false });
  if (error) { showToast('Error: ' + error.message, true); return; }
  allClients = data || [];
  renderClients(allClients);
  updateStats();
}

function updateStats() {
  const active = allClients.filter(c => c.status === 'active');
  const mrr = active.reduce((s,c) => s + (c.monthly_price||0), 0);
  document.getElementById('stat-total').textContent = allClients.length;
  document.getElementById('stat-active').textContent = active.length;
  document.getElementById('stat-texts').textContent = allClients.filter(c => c.texts_addon).length;
  document.getElementById('stat-mrr').textContent = '$' + mrr;
}

function renderClients(clients) {
  const html = clients.length === 0
    ? `<div class="empty-state"><div class="empty-icon">üè¢</div><div class="empty-title">No clients yet</div><div class="empty-sub">Click "Add Client" to get started</div></div>`
    : clients.map(clientRow).join('');
  document.querySelectorAll('#overview-clients-list, #all-clients-list').forEach(el => { if(el) el.innerHTML = html; });
}

function clientRow(c) {
  const initials = c.business_name ? c.business_name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase() : '??';
  const date = c.created_at ? new Date(c.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric'}) : '‚Äî';
  const statusBadge = c.status === 'active' ? `<span class="badge badge-active">‚óè Active</span>` : `<span class="badge badge-inactive">‚óè Inactive</span>`;
  const planBadge = c.texts_addon ? `<span class="badge badge-texts">Texts ‚úì</span>` : `<span class="badge badge-base">Base</span>`;
  const websiteBtn = c.website_url
    ? `<a class="icon-btn link-btn" href="${c.website_url}" target="_blank" title="Open site" onclick="event.stopPropagation()">‚Üó</a>`
    : `<span class="icon-btn" style="opacity:0.2;cursor:default" title="No URL set">‚Üó</span>`;
  return `
    <div class="table-row" onclick="openClientDetail('${c.id}')">
      <div class="client-name-cell">
        <div class="client-avatar">${initials}</div>
        <div><div class="client-name">${c.business_name||'‚Äî'}</div><div class="client-slug">/${c.slug||'‚Äî'}</div></div>
      </div>
      <div class="td">${c.business_type||'‚Äî'}</div>
      <div class="td">${planBadge}</div>
      <div class="td">${statusBadge}</div>
      <div class="td">${date}</div>
      <div class="row-actions" onclick="event.stopPropagation()">
        ${websiteBtn}
        <button class="icon-btn" onclick="openEditClientById('${c.id}')" title="Edit">‚úé</button>
        <button class="icon-btn danger" onclick="deleteClient('${c.id}')" title="Delete">‚úï</button>
      </div>
    </div>`;
}

function filterClients(q) {
  const f = allClients.filter(c => (c.business_name||'').toLowerCase().includes(q.toLowerCase()) || (c.business_type||'').toLowerCase().includes(q.toLowerCase()));
  document.getElementById('all-clients-list').innerHTML = f.length ? f.map(clientRow).join('') : '<div class="empty-state"><div class="empty-sub">No results</div></div>';
}

function openClientDetail(id) {
  const c = allClients.find(x => x.id === id);
  if (!c) return;
  currentClient = c;
  document.getElementById('clients-list-view').style.display = 'none';
  document.getElementById('client-detail').style.display = 'block';
  const initials = c.business_name ? c.business_name.split(' ').map(w=>w[0]).join('').slice(0,2).toUpperCase() : '??';
  document.getElementById('detail-avatar').textContent = initials;
  document.getElementById('detail-name').textContent = c.business_name||'‚Äî';
  document.getElementById('detail-page-title').textContent = c.business_name||'Client Detail';
  document.getElementById('detail-page-sub').textContent = `// ${c.business_type||'client'} ¬∑ /${c.slug||''}`;
  document.getElementById('detail-slug').textContent = `surgebuilds.co/${c.slug||''}`;
  document.getElementById('detail-price').textContent = `$${c.monthly_price||0}/mo`;
  document.getElementById('detail-type').textContent = c.business_type||'‚Äî';
  document.getElementById('detail-url').textContent = c.website_url || `surgebuilds.co/${c.slug||''}`;
  document.getElementById('detail-notes').textContent = c.notes||'No notes yet.';
  document.getElementById('detail-visit-btn').onclick = () => window.open(c.website_url || `https://surgebuilds.co/${c.slug}`, '_blank');
  document.getElementById('detail-status-badge').innerHTML = c.status === 'active' ? `<span class="badge badge-active">‚óè Active</span>` : `<span class="badge badge-inactive">‚óè Inactive</span>`;
  const perms = c.permissions||{};
  document.getElementById('permissions-toggles').innerHTML = [
    { label:'Recurring Texts Add-on', desc:'Has text campaign access', val:c.texts_addon },
    { label:'Can Edit Bio', desc:'Can update their description', val:perms.bio },
    { label:'Can Edit Services', desc:'Can manage service menu', val:perms.services },
    { label:'Can Edit Photos', desc:'Can upload photos', val:perms.photos },
    { label:'Can View Bookings', desc:'Can see incoming requests', val:perms.bookings !== false },
  ].map(p => `<div class="toggle-row"><div><div class="toggle-label">${p.label}</div><div class="toggle-desc">${p.desc}</div></div><div class="toggle ${p.val?'on':''}" style="cursor:default"></div></div>`).join('');
}

function showClientsList() { document.getElementById('clients-list-view').style.display='block'; document.getElementById('client-detail').style.display='none'; currentClient=null; }
function copyUrl() { navigator.clipboard.writeText(document.getElementById('detail-url').textContent); showToast('URL copied ‚ßâ'); }

function openAddClient() {
  editingClientId = null;
  document.getElementById('modal-title').textContent = 'Add New Client';
  document.getElementById('modal-sub').textContent = '// register a new business';
  document.getElementById('save-client-btn').textContent = 'Save Client';
  clearForm();
  document.getElementById('client-modal').classList.add('open');
}

function openEditClient() { if (currentClient) openEditClientById(currentClient.id); }

function openEditClientById(id) {
  const c = allClients.find(x => x.id === id);
  if (!c) return;
  editingClientId = id;
  document.getElementById('modal-title').textContent = 'Edit Client';
  document.getElementById('modal-sub').textContent = '// update client details';
  document.getElementById('save-client-btn').textContent = 'Update Client';
  document.getElementById('client-name').value = c.business_name||'';
  document.getElementById('client-slug').value = c.slug||'';
  document.getElementById('client-type').value = c.business_type||'';
  document.getElementById('client-price').value = c.monthly_price||'';
  document.getElementById('client-owner').value = c.owner_name||'';
  document.getElementById('client-phone').value = c.phone||'';
  document.getElementById('client-website').value = c.website_url||'';
  document.getElementById('client-notes').value = c.notes||'';
  const perms = c.permissions||{};
  toggleStates = { texts:!!c.texts_addon, bio:!!perms.bio, services:!!perms.services, photos:!!perms.photos, bookings:perms.bookings!==false };
  updateToggles();
  document.getElementById('client-modal').classList.add('open');
}

function clearForm() {
  ['client-name','client-slug','client-type','client-price','client-owner','client-phone','client-website','client-notes'].forEach(id => { document.getElementById(id).value=''; });
  toggleStates = { texts:false, bio:false, services:false, photos:false, bookings:true };
  updateToggles();
}

function closeModal() { document.getElementById('client-modal').classList.remove('open'); editingClientId=null; }
function toggleSwitch(k) { toggleStates[k]=!toggleStates[k]; updateToggles(); }
function updateToggles() { Object.keys(toggleStates).forEach(k => { const el=document.getElementById(`toggle-${k}`); if(el) el.className='toggle'+(toggleStates[k]?' on':''); }); }

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('client-name')?.addEventListener('input', function() {
    if (!editingClientId) document.getElementById('client-slug').value = this.value.toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9-]/g,'');
  });
});

async function saveClient() {
  const name = document.getElementById('client-name').value.trim();
  const slug = document.getElementById('client-slug').value.trim();
  if (!name||!slug) { showToast('Business name and slug are required',true); return; }
  const btn = document.getElementById('save-client-btn');
  btn.disabled=true; btn.textContent='Saving...';
  const payload = {
    business_name:name, slug,
    business_type:document.getElementById('client-type').value,
    monthly_price:parseInt(document.getElementById('client-price').value)||0,
    owner_name:document.getElementById('client-owner').value,
    phone:document.getElementById('client-phone').value,
    website_url:document.getElementById('client-website').value,
    notes:document.getElementById('client-notes').value,
    texts_addon:toggleStates.texts, status:'active',
    permissions:{ bio:toggleStates.bio, services:toggleStates.services, photos:toggleStates.photos, bookings:toggleStates.bookings }
  };
  let error;
  if (editingClientId) { ({error}=await sb.from('clients').update(payload).eq('id',editingClientId)); }
  else { ({error}=await sb.from('clients').insert(payload)); }
  btn.disabled=false; btn.textContent=editingClientId?'Update Client':'Save Client';
  if (error) { showToast('Error: '+error.message,true); return; }
  showToast(editingClientId?'Client updated ‚úì':'Client added ‚úì');
  closeModal(); loadClients();
}

async function deleteClient(id) {
  if (!confirm('Remove this client?')) return;
  const {error}=await sb.from('clients').delete().eq('id',id);
  if (error) { showToast('Error: '+error.message,true); return; }
  showToast('Client removed');
  loadClients();
  if (currentClient?.id===id) showClientsList();
}

function showToast(msg, isError=false) {
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.className='toast'+(isError?' error':'')+' show';
  setTimeout(()=>t.className='toast'+(isError?' error':''),3000);
}

// Also need to add website_url column to Supabase
// Run: ALTER TABLE public.clients ADD COLUMN IF NOT EXISTS website_url text;
</script>
</body>
</html>
